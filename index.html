<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Startseite</title>

<style>
:root{
  --bg:#ffffff;
  --text:#000000;
  --card:#f2f2f2;
}
body.dark{
  --bg:#121212;
  --text:#ffffff;
  --card:#1e1e1e;
}
body{
  margin:0;
  font-family:sans-serif;
  background:var(--bg);
  color:var(--text);
}
nav{
  display:flex;
  justify-content:space-around;
  background:var(--card);
  padding:10px 0;
}
nav button{
  background:none;
  border:none;
  font-size:16px;
}
section{display:none;padding:15px;}
section.active{display:block;}

/* SEITEN */
#sites{
  display:flex;
  gap:15px;
  overflow-x:auto;
}
#sites li{
  list-style:none;
  background:var(--card);
  width:100px;
  height:100px;
  border-radius:15px;
  position:relative;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  flex-shrink:0;
}
#sites img{
  width:32px;
  height:32px;
}
#sites a{
  text-decoration:none;
  color:var(--text);
  font-size:14px;
  margin-top:5px;
}

/* X im Quadrat */
#sites .delete{
  position:absolute;
  top:6px;
  right:6px;
  width:22px;
  height:22px;
  border-radius:50%;
  border:none;
  background:#e53935;
  color:white;
  font-size:12px;
  padding:0;
}

/* Verlauf */
#historyList li{
  display:flex;
  justify-content:space-between;
  background:var(--card);
  margin-bottom:8px;
  padding:8px;
  border-radius:8px;
}
#historyList .delete{
  background:#e53935;
  border:none;
  padding:4px 8px;
  border-radius:6px;
  color:white;
}

/* Formular */
input,select{
  padding:8px;
  margin:5px 0;
  width:100%;
  box-sizing:border-box;
}
button{
  padding:8px 12px;
  margin-top:5px;
}
</style>
</head>
<body>

<nav>
  <button onclick="showTab('home')">üè† Start</button>
  <button onclick="showTab('history')">üìú Verlauf</button>
  <button onclick="showTab('settings')">‚öôÔ∏è Einstellungen</button>
</nav>

<section id="home" class="active">
  <h2>Start</h2>
  <ul id="sites"></ul>

  <h3>Neue Seite</h3>
  <input id="name" placeholder="Name">
  <input id="url" placeholder="URL">
  <input id="icon" placeholder="Icon URL">
  <button onclick="addSite()">Hinzuf√ºgen</button>
</section>

<section id="history">
  <h2>Verlauf</h2>
  <ul id="historyList"></ul>
  <button onclick="clearHistory()">Verlauf komplett l√∂schen</button>
</section>

<section id="settings">
  <h2>Einstellungen</h2>
  <label>Design</label>
  <select id="themeSelect" onchange="changeTheme()">
    <option value="system">Systemeinstellung</option>
    <option value="light">Hell</option>
    <option value="dark">Dunkel</option>
  </select>
</section>

<script>
const sitesEl=document.getElementById("sites");
const historyEl=document.getElementById("historyList");

function showTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function addSite(){
  const n=name.value;
  const u=url.value;
  const i=icon.value;
  if(!n||!u)return;

  const s=JSON.parse(localStorage.getItem("sites")||"[]");
  s.push({n,u,i});
  localStorage.setItem("sites",JSON.stringify(s));
  loadSites();
  name.value=url.value=icon.value="";
}

let dragged=null;

function loadSites(){
  sitesEl.innerHTML="";
  const s=JSON.parse(localStorage.getItem("sites")||"[]");

  s.forEach((e,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`
      <button class="delete">X</button>
      <img src="${e.i||''}">
      <a href="${e.u}" target="_blank">${e.n}</a>
    `;

    li.querySelector("a").onclick=()=>addHistory(e.n,e.u);

    li.querySelector(".delete").onclick=()=>{
      s.splice(i,1);
      localStorage.setItem("sites",JSON.stringify(s));
      loadSites();
    };

    li.draggable=true;

    li.addEventListener("dragstart",()=>dragged=li);
    li.addEventListener("dragover",e=>{
      e.preventDefault();
      const after=getAfter(e.clientX);
      if(after==null)sitesEl.appendChild(dragged);
      else sitesEl.insertBefore(dragged,after);
    });
    li.addEventListener("dragend",saveOrder);

    li.addEventListener("touchstart",()=>dragged=li);
    li.addEventListener("touchmove",e=>{
      e.preventDefault();
      const touch=e.touches[0];
      const after=getAfter(touch.clientX);
      if(after==null)sitesEl.appendChild(dragged);
      else sitesEl.insertBefore(dragged,after);
    },{passive:false});
    li.addEventListener("touchend",saveOrder);

    sitesEl.appendChild(li);
  });
}

function getAfter(x){
  const els=[...sitesEl.querySelectorAll("li")];
  return els.reduce((closest,child)=>{
    const box=child.getBoundingClientRect();
    const offset=x-box.left-box.width/2;
    if(offset<0&&offset>closest.offset){
      return{offset:offset,element:child};
    }else{
      return closest;
    }
  },{offset:Number.NEGATIVE_INFINITY}).element;
}

function saveOrder(){
  const items=[...sitesEl.querySelectorAll("li")];
  const s=JSON.parse(localStorage.getItem("sites")||"[]");
  const newOrder=[];
  items.forEach(li=>{
    const name=li.querySelector("a").textContent;
    const found=s.find(e=>e.n===name);
    if(found)newOrder.push(found);
  });
  localStorage.setItem("sites",JSON.stringify(newOrder));
}

function addHistory(n,u){
  const h=JSON.parse(localStorage.getItem("history")||"[]");
  h.push({n,u});
  localStorage.setItem("history",JSON.stringify(h));
  loadHistory();
}

function loadHistory(){
  historyEl.innerHTML="";
  const h=JSON.parse(localStorage.getItem("history")||"[]");

  h.forEach((e,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`
      <span>${e.n}</span>
      <button class="delete">X</button>
    `;
    li.querySelector("span").onclick=()=>window.open(e.u,"_blank");
    li.querySelector(".delete").onclick=()=>{
      h.splice(i,1);
      localStorage.setItem("history",JSON.stringify(h));
      loadHistory();
    };
    historyEl.appendChild(li);
  });
}

function clearHistory(){
  localStorage.removeItem("history");
  loadHistory();
}

function changeTheme(){
  const val=themeSelect.value;
  localStorage.setItem("theme",val);
  applyTheme();
}

function applyTheme(){
  const val=localStorage.getItem("theme")||"system";
  themeSelect.value=val;

  if(val==="dark"){
    document.body.classList.add("dark");
  }else if(val==="light"){
    document.body.classList.remove("dark");
  }else{
    if(window.matchMedia("(prefers-color-scheme: dark)").matches){
      document.body.classList.add("dark");
    }else{
      document.body.classList.remove("dark");
    }
  }
}

loadSites();
loadHistory();
applyTheme();
</script>

</body>
</html>
